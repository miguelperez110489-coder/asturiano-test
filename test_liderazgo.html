<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Test de Estilos de Liderazgo – Supervisores Asturiano</title>
  <style>
    :root{--brand-red:#E41D23;--brand-blue:#003C8F;--ink:#111827;--muted:#6b7280;--bg:#f4f6f9;--card:#ffffff;--line:#e5e7eb}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink)}
    .hero{background:linear-gradient(120deg, rgba(0,60,143,.92), rgba(228,29,35,.92)), url('https://images.unsplash.com/photo-1520975916090-3105956dac38');background-size:cover;background-position:center;padding:56px 20px;color:#fff;text-align:center}
    .hero h1{font-size:clamp(24px,4vw,40px);margin:0 0 8px}
    .hero p{margin:0;opacity:.95}
    .container{max-width:1120px;margin:-40px auto 40px;padding:16px}
    .grid{display:grid;grid-template-columns:1fr 420px;gap:18px}
    @media(max-width:1000px){.grid{grid-template-columns:1fr}}
    .card{background:var(--card);border-radius:14px;box-shadow:0 6px 18px rgba(2,6,23,.08);padding:18px}
    .form-row{display:flex;gap:12px;margin-bottom:12px;flex-wrap:wrap}
    .form-row input{flex:1;min-width:220px;padding:10px;border:1px solid var(--line);border-radius:10px}
    .question{margin-bottom:12px;padding:12px;border-radius:10px;border:1px solid var(--line);background:#fff}
    .qtitle{font-weight:700;color:var(--brand-blue);margin-bottom:8px}
    .options label{display:block;padding:8px 10px;border-radius:8px;margin-bottom:8px;cursor:pointer;transition:all .15s;border:1px dashed transparent}
    .options input{margin-right:10px}
    .options label:hover{background:#f7fbff}
    .btn{padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
    .btn-primary{background:var(--brand-red);color:#fff}
    .btn-ghost{background:transparent;border:1px solid var(--line)}
    .btn-danger{background:#991b1b;color:#fff}
    .small{font-size:13px;color:var(--muted)}
    .badge{background:var(--brand-blue);color:#fff;padding:6px 8px;border-radius:999px;font-weight:700}
    .list-sub{max-height:300px;overflow:auto;border:1px solid var(--line);border-radius:8px;padding:8px;background:#fff}
    .entry{padding:8px;border-radius:8px;border-bottom:1px solid var(--line);display:flex;gap:8px;justify-content:space-between;align-items:center}
    .entry:last-child{border-bottom:0}
    .muted{color:var(--muted)}
    .selected{background:#eef3ff;border-color:#a7c0ff}
    .analysis-summary{margin-bottom:16px;padding:12px;border-radius:10px;background:#f9fafb;border:1px solid var(--line)}
    .analysis-summary h3{margin:0 0 8px;color:var(--brand-blue)}
    .analysis-summary p{margin:4px 0}
    .pill{display:inline-block;padding:4px 8px;border-radius:999px;font-size:12px;border:1px solid var(--line);margin-right:6px}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
</head>
<body>
  <div class="hero">
    <h1>Test de Estilos de Liderazgo</h1>
    <p>Supervisores de UDN — Tiendas Asturiano. Envío cifrado; resultados solo visibles con PIN autorizado.</p>
  </div>

  <div class="container">
    <div class="grid">
      <!-- Test -->
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <div class="small">Completa los datos y responde. No se muestran resultados tras el envío.</div>
          <div class="badge">A+ ASTURIANO</div>
        </div>
        <div class="form-row">
          <input id="participantName" placeholder="Nombre del evaluado (ej. Juan Pérez)" />
          <input id="participantUDN" placeholder="UDN (ej. UDN-045)" />
        </div>
        <form id="quizForm">
          <div id="quizArea"></div>
          <div style="display:flex;gap:10px;align-items:center;margin-top:10px;flex-wrap:wrap">
            <button class="btn btn-primary" type="submit">Enviar respuestas (no muestra resultado)</button>
            <button class="btn btn-ghost" type="button" id="clearForm">Limpiar</button>
            <div class="small">Tus envíos quedan cifrados en este navegador.</div>
          </div>
        </form>
        <div id="msg" class="small" style="margin-top:8px"></div>
      </div>

      <!-- Admin panel -->
      <div>
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;flex-wrap:wrap">
            <strong>Ver resultados (acceso restringido)</strong>
            <span class="small">PIN requerido</span>
          </div>
          <div style="display:flex;gap:8px;margin-bottom:8px;flex-wrap:wrap">
            <input id="pinInput" placeholder="PIN" />
            <button id="unlockBtn" class="btn btn-primary">Abrir</button>
            <button id="clearAll" class="btn btn-danger">Borrar todo</button>
            <button id="exportAll" class="btn btn-ghost">Exportar JSON</button>
            <button id="exportExcel" class="btn btn-ghost">Descargar Excel</button>
            <button id="refreshList" class="btn btn-ghost">Actualizar</button>
          </div>
          <div id="unlockMsg" class="small muted"></div>
          <div id="resultBox" style="display:none;margin-top:12px">
            <div id="submissionsList" class="list-sub"></div>
            <div style="height:12px"></div>
            <div id="analysisArea"></div>
          </div>
          <div class="small" style="margin-top:10px">Nota: si tu navegador bloquea el guardado, ábrelo con un servidor local (p. ej. <code>python -m http.server</code> y entra a <code>http://localhost:8000</code>).</div>
        </div>
      </div>
    </div>
  </div>

  <script>
  window.onload = () => {
    const questions=[
      {q:"Cuando visitas una UDN y notas incumplimiento de metas, ¿qué haces?",opts:["Das órdenes estrictas.","Reúnes al equipo para analizar causas.","Motivas con ejemplos positivos.","Dejas que lo resuelvan solos."],map:['A','D','T','L']},
      {q:"Un empresario no realizó corte Z correctamente. ¿Cómo actúas?",opts:["Le ordenas corregir al instante.","Revisas con él para enseñarle.","Explicas la importancia del corte.","Le das libertad de hacerlo luego."],map:['A','D','T','L']},
      {q:"Nuevo protocolo de cíclicos. ¿Cómo lo introduces?",opts:["Exiges cumplimiento inmediato.","Solicitas opiniones y sugerencias.","Compartes la visión de mejora.","Informas y cada quien decide."],map:['A','D','T','L']},
      {q:"Dos empleados discuten en jornada. ¿Qué haces?",opts:["Impones orden de inmediato.","Escuchas a ambas partes.","Inspiras a pensar en objetivo común.","No te involucras."],map:['A','D','T','L']},
      {q:"Se pide cíclico extra urgente. ¿Qué haces?",opts:["Das instrucción directa.","Preguntas quién puede apoyar.","Motivas con relevancia del cíclico.","Permites que lo hagan si quieren."],map:['A','D','T','L']},
      {q:"Equipo desanimado. ¿Cómo respondes?",opts:["Recuerdas la obligación.","Dialogas y propones estrategias.","Inspiras visión positiva.","Les das espacio."],map:['A','D','T','L']},
      {q:"Múltiples UDN que visitar en un día:",opts:["Das instrucciones rígidas.","Delegas y supervisas.","Confías en que se inspiren.","Cada quien que haga lo suyo."],map:['A','D','T','L']},
      {q:"Error grave en caja:",opts:["Llamas la atención inmediata.","Analizas en conjunto.","Lo conviertes en aprendizaje.","No das importancia."],map:['A','D','T','L']},
      {q:"Empresario quiere mejorar exhibición:",opts:["Le dices cómo hacerlo.","Escuchas sus ideas.","Lo motivas a innovar.","No intervienes."],map:['A','D','T','L']},
      {q:"Decisión sobre promoción urgente:",opts:["La tomas tú mismo.","Preguntas opiniones antes de decidir.","Explicas la visión detrás.","Dejas que decida empresario."],map:['A','D','T','L']},
      {q:"Registros de sistema no actualizados. ¿Qué haces?",opts:["Ordenas actualización inmediata.","Reorganizas con personal.","Motivas resaltando beneficios.","Dejas que lo hagan a su ritmo."],map:['A','D','T','L']},
      {q:"UDN supera ventas:",opts:["Felicitas pero exiges mantener ritmo.","Reconoces públicamente.","Inspiras al resto.","No das reconocimiento especial."],map:['A','D','T','L']},
      {q:"Incendio en la tienda. ¿Qué haces?",opts:["Das órdenes estrictas y evacuación inmediata.","Coordinas escuchando propuestas de acción.","Motivas manteniendo calma.","Esperas que el empresario actúe."],map:['A','D','T','L']},
      {q:"Entrega de proveedor con faltantes:",opts:["Exiges reposición inmediata.","Dialogas y levantas acta.","Motivas a registrar evidencias.","Ignoras situación."],map:['A','D','T','L']},
      {q:"Supervisor detecta merma sin causa:",opts:["Sancionas directo.","Investigación con equipo.","Lo conviertes en lección.","No actúas."],map:['A','D','T','L']},
      {q:"Se debe implementar nueva política:",opts:["Ordenas cumplimiento ya.","Convocas reunión de consenso.","Presentas visión inspiradora.","No haces seguimiento."],map:['A','D','T','L']},
      {q:"Conflicto entre empresarios de UDN distintas:",opts:["Decides solución unilateral.","Escuchas a ambos.","Los inspiras a colaborar.","No intervienes."],map:['A','D','T','L']},
      {q:"Nueva estrategia comercial desde dirección:",opts:["Impones aplicación literal.","Pides sugerencias locales.","Motivas compartiendo visión.","Cada UDN libre de aplicarla."],map:['A','D','T','L']},
      {q:"Un cajero reincide en error:",opts:["Sanción inmediata.","Capacitación y acompañamiento.","Motivación y confianza.","Dejas que aprenda solo."],map:['A','D','T','L']},
      {q:"UDN enfrenta baja de ventas:",opts:["Exiges recuperar a la fuerza.","Analizas causas con equipo.","Motivas con campañas.","Dejas que el empresario busque solución."],map:['A','D','T','L']}
    ];

    // Render preguntas
    const quizArea=document.getElementById('quizArea');
    questions.forEach((it,idx)=>{
      const div=document.createElement('div'); div.className='question';
      const qtitle=document.createElement('div'); qtitle.className='qtitle'; qtitle.textContent=`${idx+1}. ${it.q}`;
      div.appendChild(qtitle);
      const opts=document.createElement('div'); opts.className='options';
      it.opts.forEach((o,i)=>{
        const lbl=document.createElement('label');
        lbl.innerHTML=`<input type='radio' name='q${idx}' value='${i}'> ${o}`;
        lbl.addEventListener('click',()=>{
          [...opts.querySelectorAll('label')].forEach(l=>l.classList.remove('selected'));
          lbl.classList.add('selected');
        });
        opts.appendChild(lbl);
      });
      div.appendChild(opts); quizArea.appendChild(div);
    });

    // Storage + PIN
    const STORAGE_KEY='asturiano_liderazgo_full_enc';
    const DEFAULT_PIN='6483';
    const encodeRecord=(obj,pin)=> btoa(pin+'|'+JSON.stringify(obj));
    const decodeRecord=(enc,pin)=>{ try{const dec=atob(enc); if(!dec.startsWith(pin+'|')) return null; return JSON.parse(dec.slice(pin.length+1));}catch(e){return null} };
    const saveSubmission=(enc)=>{ const arr=JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]'); arr.push(enc); localStorage.setItem(STORAGE_KEY,JSON.stringify(arr)); };
    const getAllSubmissions=()=> JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]');
    const deleteSubmission=(index)=>{ const arr=getAllSubmissions(); arr.splice(index,1); localStorage.setItem(STORAGE_KEY,JSON.stringify(arr)); };

    document.getElementById('quizForm').addEventListener('submit',e=>{
      e.preventDefault();
      const name=document.getElementById('participantName').value.trim();
      const udn=document.getElementById('participantUDN').value.trim();
      if(!name||!udn){document.getElementById('msg').textContent='Completa nombre y UDN.'; return}
      const answers=[]; for(let i=0;i<questions.length;i++){ const sel=document.querySelector(`input[name=q${i}]:checked`); answers.push(sel?parseInt(sel.value):null); }
      if(answers.some(v=>v===null)){document.getElementById('msg').textContent='Responde todas las preguntas.'; return}
      const record={name,udn,timestamp:new Date().toISOString(),answers};
      saveSubmission(encodeRecord(record,DEFAULT_PIN));
      document.getElementById('quizForm').reset();
      document.getElementById('msg').textContent='Respuestas guardadas. Usa el PIN en el panel derecho para ver resultados.';
    });

    document.getElementById('clearForm').addEventListener('click',()=>{document.getElementById('quizForm').reset();document.getElementById('msg').textContent='Formulario limpio.'});

    // Admin
    document.getElementById('unlockBtn').addEventListener('click',()=>{
      const pin=document.getElementById('pinInput').value.trim();
      const arr=getAllSubmissions();
      if(arr.length===0){document.getElementById('unlockMsg').textContent='No hay registros.'; return}
      const ok=arr.some(enc=>decodeRecord(enc,pin));
      if(!ok){document.getElementById('unlockMsg').textContent='PIN incorrecto.'; return}
      document.getElementById('unlockMsg').textContent='PIN correcto.';
      document.getElementById('resultBox').style.display='block';
      populateList(pin);
    });

    document.getElementById('refreshList').addEventListener('click',()=>{
      const pin=document.getElementById('pinInput').value.trim();
      populateList(pin);
    });

    document.getElementById('exportAll').addEventListener('click',()=>{
      const pin=document.getElementById('pinInput').value.trim();
      const arr=getAllSubmissions().map(enc=>decodeRecord(enc,pin)).filter(Boolean);
      const blob=new Blob([JSON.stringify(arr,null,2)],{type:'application/json'});
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=`resultados_liderazgo_${new Date().toISOString().slice(0,10)}.json`; a.click(); URL.revokeObjectURL(a.href);
    });

    document.getElementById('exportExcel').addEventListener('click',()=>{
      const pin=document.getElementById('pinInput').value.trim();
      const raw=getAllSubmissions().map(enc=>decodeRecord(enc,pin)).filter(Boolean);
      if(!raw.length){ alert('No hay registros para exportar.'); return; }
      const rows = raw.map((r,idx)=>{
        const counts={A:0,D:0,T:0,L:0};
        r.answers.forEach((a,i)=>{ if(a!==null) counts[questions[i].map[a]]++; });
        const best = Object.entries(counts).sort((a,b)=>b[1]-a[1])[0][0];
        const bestName = {A:'Autocrático',D:'Democrático',T:'Transformacional',L:'Laissez-faire'}[best];
        return { "#": idx+1, "Nombre": r.name, "UDN": r.udn, "Fecha/Hora": new Date(r.timestamp).toLocaleString(),
          Autocrático: counts.A, Democrático: counts.D, Transformacional: counts.T, LaissezFaire: counts.L, "Predominante": bestName };
      });
      const ws = XLSX.utils.json_to_sheet(rows);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Resultados");
      XLSX.writeFile(wb, "resultados_test_liderazgo.xlsx");
    });

    document.getElementById('clearAll').addEventListener('click',()=>{
      const pin=document.getElementById('pinInput').value.trim();
      if(!pin){alert('Ingresa el PIN'); return}
      if(!confirm('¿Seguro que deseas borrar TODOS los registros?')) return;
      const arr=getAllSubmissions();
      if(arr.length && !decodeRecord(arr[0],pin)){ alert('PIN incorrecto'); return;}
      localStorage.setItem(STORAGE_KEY,JSON.stringify([]));
      populateList(pin);
      document.getElementById('analysisArea').innerHTML='';
      alert('Registros eliminados.');
    });

    function populateList(pin){
      const container=document.getElementById('submissionsList'); container.innerHTML='';
      const arr=getAllSubmissions();
      arr.forEach((enc,idx)=>{
        const rec=decodeRecord(enc,pin); if(!rec) return;
        const div=document.createElement('div'); div.className='entry';
        div.innerHTML=`<div><strong>${rec.name}</strong>
           <div class='muted'>${rec.udn} • ${new Date(rec.timestamp).toLocaleString()}</div></div>
           <div>
             <button class='btn btn-ghost' data-idx='${idx}' data-action='view'>Ver</button>
             <button class='btn btn-danger' data-idx='${idx}' data-action='del'>Borrar</button>
           </div>`;
        container.appendChild(div);
      });
      container.querySelectorAll('button[data-action]').forEach(btn=>btn.addEventListener('click',e=>{
        const idx=parseInt(e.currentTarget.getAttribute('data-idx'));
        const action=e.currentTarget.getAttribute('data-action');
        const pin=document.getElementById('pinInput').value.trim();
        if(action==='view'){ showAnalysis(idx,pin); }
        if(action==='del'){ if(confirm('¿Borrar este registro?')){ deleteSubmission(idx); populateList(pin); } }
      }));
    }

    // Análisis
    function showAnalysis(index,pin){
      const rec=decodeRecord(getAllSubmissions()[index],pin); if(!rec) return;
      const counts={A:0,D:0,T:0,L:0};
      rec.answers.forEach((ans,i)=>{ if(ans!==null) counts[questions[i].map[ans]]++; });
      const bestStyle = Object.entries(counts).sort((a,b)=>b[1]-a[1])[0][0];

      const styleInfo={
        A:{name:'Autocrático',def:'Control directo, decisión unilateral y disciplina.',
           bueno:['Alta claridad en crisis','Velocidad para decidir'],
           malo:['Riesgo de desmotivación','Baja innovación local'],
           rec:['Usar en incidentes críticos','Combinar con escucha y feedback']},
        D:{name:'Democrático',def:'Participación del equipo y toma de decisiones compartida.',
           bueno:['Compromiso del equipo','Mejor información para decidir'],
           malo:['Ralentiza en urgencias','Riesgo de diluir responsabilidades'],
           rec:['Definir tiempos de decisión','Cerrar con acuerdos claros']},
        T:{name:'Transformacional',def:'Inspira, alinea con visión y promueve mejora continua.',
           bueno:['Motiva y desarrolla','Fomenta innovación'],
           malo:['Puede descuidar controles','Exceso de discurso sin ejecución'],
           rec:['Aterrizar planes con KPIs','Revisiones semanales de avance']},
        L:{name:'Laissez-faire',def:'Alta autonomía, mínima intervención directa.',
           bueno:['Empodera a expertos','Favorece aprendizaje'],
           malo:['Riesgo de descontrol','Falta de seguimiento'],
           rec:['Definir métricas y cadencia','Escalamiento temprano de riesgos']}
      };

      const s=styleInfo[bestStyle];
      const area=document.getElementById('analysisArea'); area.innerHTML='';
      const summary=document.createElement('div');
      summary.className='analysis-summary';
      summary.innerHTML = `<h3>Estilo predominante: ${s.name}</h3>
        <p><em>${s.def}</em></p>
        <p class='pill'>Autocrático: ${counts.A}</p>
        <p class='pill'>Democrático: ${counts.D}</p>
        <p class='pill'>Transformacional: ${counts.T}</p>
        <p class='pill'>Laissez-faire: ${counts.L}</p>
        <p><strong>Lo bueno:</strong> ${s.bueno.join(' • ')}</p>
        <p><strong>Lo malo:</strong> ${s.malo.join(' • ')}</p>
        <p><strong>Recomendado:</strong> ${s.rec.join(' • ')}</p>`;
      area.appendChild(summary);

      const canvas=document.createElement('canvas'); area.appendChild(canvas);
      new Chart(canvas,{
        type:'radar',
        data:{labels:['Autocrático','Democrático','Transformacional','Laissez-faire'],
              datasets:[{label:'Perfil de liderazgo', data:[counts.A,counts.D,counts.T,counts.L]}]},
        options:{responsive:true, scales:{r:{beginAtZero:true, ticks:{stepSize:1}}}}
      });
    }
  }
  </script>
</body>
</html>
