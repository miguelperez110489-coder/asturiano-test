<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Test de Integridad y Ética – Supervisores Asturiano</title>
  <style>
    :root{--brand-red:#E41D23;--brand-blue:#003C8F;--ink:#111827;--muted:#6b7280;--bg:#f4f6f9;--card:#ffffff;--line:#e5e7eb}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink)}
    .hero{background:linear-gradient(120deg, rgba(0,60,143,.92), rgba(228,29,35,.92)), url('https://images.unsplash.com/photo-1520975916090-3105956dac38');background-size:cover;background-position:center;padding:56px 20px;color:#fff;text-align:center}
    .hero h1{font-size:clamp(24px,4vw,40px);margin:0 0 8px}
    .hero p{margin:0;opacity:.95}
    .container{max-width:1120px;margin:-40px auto 40px;padding:16px}
    .grid{display:grid;grid-template-columns:1fr 420px;gap:18px}
    @media(max-width:1000px){.grid{grid-template-columns:1fr}}
    .card{background:var(--card);border-radius:14px;box-shadow:0 6px 18px rgba(2,6,23,.08);padding:18px}
    .form-row{display:flex;gap:12px;margin-bottom:12px;flex-wrap:wrap}
    .form-row input{flex:1;min-width:220px;padding:10px;border:1px solid var(--line);border-radius:10px}
    .question{margin-bottom:12px;padding:12px;border-radius:10px;border:1px solid var(--line);background:#fff}
    .qtitle{font-weight:700;color:var(--brand-blue);margin-bottom:8px}
    .options label{display:block;padding:8px 10px;border-radius:8px;margin-bottom:8px;cursor:pointer;transition:all .15s;border:1px dashed transparent}
    .options input{margin-right:10px}
    .options label:hover{background:#f7fbff}
    .btn{padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
    .btn-primary{background:var(--brand-red);color:#fff}
    .btn-ghost{background:transparent;border:1px solid var(--line)}
    .btn-danger{background:#991b1b;color:#fff}
    .small{font-size:13px;color:var(--muted)}
    .badge{background:var(--brand-blue);color:#fff;padding:6px 8px;border-radius:999px;font-weight:700}
    .list-sub{max-height:300px;overflow:auto;border:1px solid var(--line);border-radius:8px;padding:8px;background:#fff}
    .entry{padding:8px;border-radius:8px;border-bottom:1px solid var(--line);display:flex;gap:8px;justify-content:space-between;align-items:center}
    .entry:last-child{border-bottom:0}
    .muted{color:var(--muted)}
    .selected{background:#eef3ff;border-color:#a7c0ff}
    .analysis-summary{margin-bottom:16px;padding:12px;border-radius:10px;background:#f9fafb;border:1px solid var(--line)}
    .analysis-summary h3{margin:0 0 8px;color:var(--brand-blue)}
    .analysis-summary p{margin:4px 0}
    .pill{display:inline-block;padding:4px 8px;border-radius:999px;font-size:12px;border:1px solid var(--line);margin-right:6px}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
</head>
<body>
  <div class="hero">
    <h1>Test de Integridad y Ética</h1>
    <p>Supervisores de UDN — Tiendas Asturiano. Envío cifrado; resultados solo visibles con PIN autorizado.</p>
  </div>

  <div class="container">
    <div class="grid">
      <!-- Test -->
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <div class="small">Completa los datos y responde. No se muestran resultados tras el envío.</div>
          <div class="badge">A+ ASTURIANO</div>
        </div>
        <div class="form-row">
          <input id="participantName" placeholder="Nombre del evaluado (ej. Juan Pérez)" />
          <input id="participantUDN" placeholder="UDN (ej. UDN-045)" />
        </div>
        <form id="quizForm">
          <div id="quizArea"></div>
          <div style="display:flex;gap:10px;align-items:center;margin-top:10px;flex-wrap:wrap">
            <button class="btn btn-primary" type="submit">Enviar respuestas (no muestra resultado)</button>
            <button class="btn btn-ghost" type="button" id="clearForm">Limpiar</button>
            <div class="small">Tus envíos quedan cifrados en este navegador.</div>
          </div>
        </form>
        <div id="msg" class="small" style="margin-top:8px"></div>
      </div>

      <!-- Admin panel -->
      <div>
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;flex-wrap:wrap">
            <strong>Ver resultados (acceso restringido)</strong>
            <span class="small">PIN requerido</span>
          </div>
          <div style="display:flex;gap:8px;margin-bottom:8px;flex-wrap:wrap">
            <input id="pinInput" placeholder="PIN" />
            <button id="unlockBtn" class="btn btn-primary">Abrir</button>
            <button id="clearAll" class="btn btn-danger">Borrar todo</button>
            <button id="exportAll" class="btn btn-ghost">Exportar JSON</button>
            <button id="exportExcel" class="btn btn-ghost">Descargar Excel</button>
            <button id="refreshList" class="btn btn-ghost">Actualizar</button>
          </div>
          <div id="unlockMsg" class="small muted"></div>
          <div id="resultBox" style="display:none;margin-top:12px">
            <div id="submissionsList" class="list-sub"></div>
            <div style="height:12px"></div>
            <div id="analysisArea"></div>
          </div>
          <div class="small" style="margin-top:10px">Nota: si tu navegador bloquea el guardado, ábrelo con un servidor local (p. ej. <code>python -m http.server</code> y entra a <code>http://localhost:8000</code>).</div>
        </div>
      </div>
    </div>
  </div>

  <script>
  window.onload = () => {
    // ---------- Preguntas (20) ----------
    const baseQuestions=[
      {topic:'caja', q:'Encuentras un retiro en caja sin comprobante durante el corte Z. ¿Qué haces?',
        opts:[{t:'Solicitar comprobante y registrar incidencia si no existe.',ok:true},
              {t:'Ignorar, es responsabilidad del empresario.',ok:false},
              {t:'Ajustar el corte para que cuadre.',ok:false},
              {t:'Esperar al siguiente turno para ver si aparece.',ok:false}]},
      {topic:'proveedor', q:'Un proveedor ofrece “regalos” para acelerar descarga.',
        opts:[{t:'Rechazar y reportar el intento por posible conflicto de interés.',ok:true},
              {t:'Aceptar, pero compartir con el equipo.',ok:false},
              {t:'Aceptar si no afecta el precio.',ok:false},
              {t:'Ignorar y continuar sin reportar.',ok:false}]},
      {topic:'cíclicos', q:'Faltantes recurrentes en cíclico de alto valor.',
        opts:[{t:'Solicitar investigación y levantar incidencia con evidencia.',ok:true},
              {t:'Justificar sin evidencia para evitar problemas.',ok:false},
              {t:'Ajustar manualmente el sistema.',ok:false},
              {t:'Dejar pasar porque “es común”.',ok:false}]},
      {topic:'tickets', q:'Detectas omisión de tickets manuales para quedarse con efectivo.',
        opts:[{t:'Asegurar evidencias y escalar según protocolo disciplinario.',ok:true},
              {t:'Pedir que lo deje de hacer sin registrar.',ok:false},
              {t:'Cubrir la diferencia para evitar reporte.',ok:false},
              {t:'Cambiar al cajero de turno sin registrar.',ok:false}]},
      {topic:'inventario', q:'Te piden ajustar inventario sin evidencia para “cuadrar”.',
        opts:[{t:'Negarte y solicitar soporte documental (recepción/fotos).',ok:true},
              {t:'Hacerlo y documentarlo después.',ok:false},
              {t:'Hacerlo si lo solicita el empresario.',ok:false},
              {t:'Hacerlo solo esta vez.',ok:false}]},
      {topic:'promociones', q:'Piden extender una promoción vencida para “cumplir venta”.',
        opts:[{t:'Negarse; comunicar fechas vigentes y alternativas autorizadas.',ok:true},
              {t:'Aplicarla si el cliente lo pide.',ok:false},
              {t:'Aplicarla solo en horas de baja afluencia.',ok:false},
              {t:'Aplicarla si se repone la diferencia en caja.',ok:false}]},
      {topic:'datos', q:'Solicitan acceso a datos de ventas de otra UDN sin autorización.',
        opts:[{t:'Negarse y remitir a canal formal de solicitud.',ok:true},
              {t:'Compartir por confianza entre supervisores.',ok:false},
              {t:'Enviar por WhatsApp temporalmente.',ok:false},
              {t:'Solo pasar el resumen sin nombre de UDN.',ok:false}]},
      {topic:'mermas', q:'Merma “no identificada” sin evidencias.',
        opts:[{t:'Pedir evidencias y revisar cámaras/recepciones antes de ajustar.',ok:true},
              {t:'Ajustar para limpiar el reporte.',ok:false},
              {t:'Aceptar la merma si es pequeña.',ok:false},
              {t:'Cerrar el mes sin aclarar.',ok:false}]},
      {topic:'conflicto', q:'Un familiar tuyo es empresario de una UDN.',
        opts:[{t:'Declarar conflicto de interés y solicitar reasignación.',ok:true},
              {t:'Supervisarlo con “más cuidado”.',ok:false},
              {t:'Aprovechar para impulsar sus ventas.',ok:false},
              {t:'Solo evitar sancionarlo.',ok:false}]},
      {topic:'seguridad', q:'Se detecta riesgo de incendio por sobrecarga eléctrica.',
        opts:[{t:'Detener operación afectada y activar protocolo de seguridad.',ok:true},
              {t:'Seguir operando hasta el cierre.',ok:false},
              {t:'Avisar al final del día.',ok:false},
              {t:'Colocar un letrero y continuar.',ok:false}]},
      {topic:'depósitos', q:'Depósito bancario incompleto respecto al corte Z.',
        opts:[{t:'Solicitar aclaración inmediata y evidencia de depósito.',ok:true},
              {t:'Cubrir la diferencia temporalmente.',ok:false},
              {t:'Esperar al cierre semanal.',ok:false},
              {t:'Registrar como merma de caja sin revisión.',ok:false}]},
      {topic:'evidencias', q:'Te piden “agilizar” auditoría quitando fotos de evidencia.',
        opts:[{t:'Negarse; evidencias son obligatorias.',ok:true},
              {t:'Eliminar fotos de faltantes menores.',ok:false},
              {t:'Enviar solo texto de resumen.',ok:false},
              {t:'Mandar fotos antiguas.',ok:false}]},
      {topic:'informes', q:'Reportas una irregularidad. Dirección te pide “suavizar” el lenguaje.',
        opts:[{t:'Mantener hechos objetivos y adjuntar evidencia.',ok:true},
              {t:'Cambiarlo por términos ambiguos.',ok:false},
              {t:'Retirar montos precisos.',ok:false},
              {t:'Bajar el nivel a “observación menor”.',ok:false}]},
      {topic:'sanciones', q:'Cajero reincidente tras capacitación y advertencia.',
        opts:[{t:'Aplicar protocolo disciplinario y documentar.',ok:true},
              {t:'Solo cambiarlo de turno.',ok:false},
              {t:'Pedirle que “ya no lo haga”.',ok:false},
              {t:'Ignorar para no afectar clima.',ok:false}]},
      {topic:'auditoría', q:'Auditor solicita acceso a información sensible.',
        opts:[{t:'Verificar credenciales y otorgar lo autorizado.',ok:true},
              {t:'Dar acceso completo por ser auditor.',ok:false},
              {t:'Mandar todo por correo personal.',ok:false},
              {t:'Compartir vía USB sin registro.',ok:false}]},
      {topic:'corteZ', q:'Diferencia en efectivo por error del empresario.',
        opts:[{t:'Registrar incidencia, pedir reposición y reforzar proceso.',ok:true},
              {t:'Cubrir con caja chica.',ok:false},
              {t:'Mover a otras cuentas para “compensar”.',ok:false},
              {t:'Cerrar sin aclarar y ver después.',ok:false}]},
      {topic:'proveedor2', q:'Proveedor pide firmar recepción completa con faltantes.',
        opts:[{t:'Negarse y firmar solo lo efectivamente recibido.',ok:true},
              {t:'Firmar y pedir reposición después.',ok:false},
              {t:'Firmar si el proveedor es de confianza.',ok:false},
              {t:'Firmar para evitar demoras y ajustar luego.',ok:false}]},
      {topic:'privacidad', q:'Grupo de WhatsApp pide fotos de cámaras de seguridad.',
        opts:[{t:'Negarse y usar canal formal con autorización.',ok:true},
              {t:'Enviar video si no se ve gente.',ok:false},
              {t:'Enviar foto borrosa nada más.',ok:false},
              {t:'Compartir en horario nocturno.',ok:false}]},
      {topic:'transparencia', q:'Se solicita cambiar fecha de reporte para “mejorar indicadores”.',
        opts:[{t:'Negarse; la fecha debe reflejar el evento real.',ok:true},
              {t:'Cambiar si dirección lo pide.',ok:false},
              {t:'Cambiar si mejora el bono.',ok:false},
              {t:'Cambiar si no afecta a nadie.',ok:false}]},
      {topic:'denuncia', q:'Observas posible robo interno con evidencias parciales.',
        opts:[{t:'Asegurar evidencias, notificar y seguir protocolo de investigación.',ok:true},
              {t:'Enfrentar al sospechoso sin registro.',ok:false},
              {t:'Publicarlo en el grupo general.',ok:false},
              {t:'Ignorar hasta tener video claro.',ok:false}]}
    ];

    // ---------- Render con mezcla aleatoria y snapshot ----------
    const quizArea=document.getElementById('quizArea');
    // Mezclar opciones en cada carga y guardar snapshot de preguntas
    const questions = baseQuestions.map(q => {
      const shuffled = q.opts.map(o=>({text:o.t, ok:o.ok}));
      for(let i=shuffled.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [shuffled[i],shuffled[j]]=[shuffled[j],shuffled[i]];
      }
      return {topic:q.topic, q:q.q, opts:shuffled};
    });

    // Pintar preguntas
    questions.forEach((it,idx)=>{
      const div=document.createElement('div'); div.className='question';
      const qtitle=document.createElement('div'); qtitle.className='qtitle'; qtitle.textContent=`${idx+1}. ${it.q}`;
      div.appendChild(qtitle);
      const opts=document.createElement('div'); opts.className='options';
      it.opts.forEach((o,i)=>{
        const lbl=document.createElement('label');
        lbl.innerHTML=`<input type='radio' name='q${idx}' value='${i}'> ${o.text}`;
        lbl.addEventListener('click',()=>{
          [...opts.querySelectorAll('label')].forEach(l=>l.classList.remove('selected'));
          lbl.classList.add('selected');
        });
        opts.appendChild(lbl);
      });
      div.appendChild(opts); quizArea.appendChild(div);
    });

    // ---------- Storage + PIN (idéntico a los otros) ----------
    const STORAGE_KEY='asturiano_integridad_enc_v2';
    const DEFAULT_PIN='6483';
    const encodeRecord=(obj,pin)=> btoa(pin+'|'+JSON.stringify(obj));
    const decodeRecord=(enc,pin)=>{ try{const dec=atob(enc); if(!dec.startsWith(pin+'|')) return null; return JSON.parse(dec.slice(pin.length+1));}catch(e){return null} };
    const saveSubmission=(enc)=>{ const arr=JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]'); arr.push(enc); localStorage.setItem(STORAGE_KEY,JSON.stringify(arr)); };
    const getAllSubmissions=()=> JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]');
    const deleteSubmission=(index)=>{ const arr=getAllSubmissions(); arr.splice(index,1); localStorage.setItem(STORAGE_KEY,JSON.stringify(arr)); };

    // Envío
    document.getElementById('quizForm').addEventListener('submit',e=>{
      e.preventDefault();
      const name=document.getElementById('participantName').value.trim();
      const udn=document.getElementById('participantUDN').value.trim();
      if(!name||!udn){document.getElementById('msg').textContent='Completa nombre y UDN.'; return}
      const answers=[]; for(let i=0;i<questions.length;i++){ const sel=document.querySelector(`input[name=q${i}]:checked`); answers.push(sel?parseInt(sel.value):null); }
      if(answers.some(v=>v===null)){document.getElementById('msg').textContent='Responde todas las preguntas.'; return}
      const record={name,udn,timestamp:new Date().toISOString(),answers,questions}; // snapshot incluido
      saveSubmission(encodeRecord(record,DEFAULT_PIN));
      document.getElementById('quizForm').reset();
      document.getElementById('msg').textContent='Respuestas guardadas. Usa el PIN en el panel derecho para ver resultados.';
    });

    document.getElementById('clearForm').addEventListener('click',()=>{document.getElementById('quizForm').reset();document.getElementById('msg').textContent='Formulario limpio.'});

    // ---------- Admin ----------
    document.getElementById('unlockBtn').addEventListener('click',()=>{
      const pin=document.getElementById('pinInput').value.trim();
      const arr=getAllSubmissions();
      if(arr.length===0){document.getElementById('unlockMsg').textContent='No hay registros.'; return}
      const ok=arr.some(enc=>decodeRecord(enc,pin));
      if(!ok){document.getElementById('unlockMsg').textContent='PIN incorrecto.'; return}
      document.getElementById('unlockMsg').textContent='PIN correcto.';
      document.getElementById('resultBox').style.display='block';
      populateList(pin);
    });

    document.getElementById('refreshList').addEventListener('click',()=>{
      const pin=document.getElementById('pinInput').value.trim();
      populateList(pin);
    });

    document.getElementById('exportAll').addEventListener('click',()=>{
      const pin=document.getElementById('pinInput').value.trim();
      const arr=getAllSubmissions().map(enc=>decodeRecord(enc,pin)).filter(Boolean);
      const blob=new Blob([JSON.stringify(arr,null,2)],{type:'application/json'});
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=`resultados_integridad_${new Date().toISOString().slice(0,10)}.json`; a.click(); URL.revokeObjectURL(a.href);
    });

    document.getElementById('exportExcel').addEventListener('click',()=>{
      const pin=document.getElementById('pinInput').value.trim();
      const raw=getAllSubmissions().map(enc=>decodeRecord(enc,pin)).filter(Boolean);
      if(!raw.length){ alert('No hay registros para exportar.'); return; }
      const rows = raw.map((r,idx)=>{
        const evals = r.answers.map((a,i)=> (a!==null && r.questions[i].opts[a].ok) ? 'ETICO':'RIESGO');
        const score = evals.filter(x=>x==='ETICO').length;
        const base={ "#": idx+1, "Nombre": r.name, "UDN": r.udn, "Fecha/Hora": new Date(r.timestamp).toLocaleString(), "Puntaje Ético": score };
        evals.forEach((v,i)=> base[`P${i+1}`]=v );
        return base;
      });
      const ws = XLSX.utils.json_to_sheet(rows);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Resultados");
      XLSX.writeFile(wb, "resultados_test_integridad.xlsx");
    });

    document.getElementById('clearAll').addEventListener('click',()=>{
      const pin=document.getElementById('pinInput').value.trim();
      if(!pin){alert('Ingresa el PIN'); return}
      if(!confirm('¿Seguro que deseas borrar TODOS los registros?')) return;
      const arr=getAllSubmissions();
      if(arr.length && !decodeRecord(arr[0],pin)){ alert('PIN incorrecto'); return;}
      localStorage.setItem(STORAGE_KEY,JSON.stringify([]));
      populateList(pin);
      document.getElementById('analysisArea').innerHTML='';
      alert('Registros eliminados.');
    });

    function populateList(pin){
      const container=document.getElementById('submissionsList'); container.innerHTML='';
      const arr=getAllSubmissions();
      arr.forEach((enc,idx)=>{
        const rec=decodeRecord(enc,pin); if(!rec) return;
        const div=document.createElement('div'); div.className='entry';
        div.innerHTML=`<div><strong>${rec.name}</strong>
           <div class='muted'>${rec.udn} • ${new Date(rec.timestamp).toLocaleString()}</div></div>
           <div>
             <button class='btn btn-ghost' data-idx='${idx}' data-action='view'>Ver</button>
             <button class='btn btn-danger' data-idx='${idx}' data-action='del'>Borrar</button>
           </div>`;
        container.appendChild(div);
      });
      container.querySelectorAll('button[data-action]').forEach(btn=>btn.addEventListener('click',e=>{
        const idx=parseInt(e.currentTarget.getAttribute('data-idx'));
        const action=e.currentTarget.getAttribute('data-action');
        const pin=document.getElementById('pinInput').value.trim();
        if(action==='view'){ showAnalysis(idx,pin); }
        if(action==='del'){ if(confirm('¿Borrar este registro?')){ deleteSubmission(idx); populateList(pin); } }
      }));
    }

    // ---------- Análisis ----------
    function showAnalysis(index,pin){
      const rec=decodeRecord(getAllSubmissions()[index],pin); if(!rec) return;
      const total=rec.questions.length;
      let etico=0;
      const areaCounts={caja:0, proveedor:0, 'cíclicos':0, tickets:0, inventario:0, promociones:0, datos:0, mermas:0, conflicto:0, seguridad:0, depósitos:0, evidencias:0, informes:0, sanciones:0, auditoría:0, corteZ:0, proveedor2:0, privacidad:0, transparencia:0, denuncia:0};
      const areaRiesgo={caja:0, proveedor:0, 'cíclicos':0, tickets:0, inventario:0, promociones:0, datos:0, mermas:0, conflicto:0, seguridad:0, depósitos:0, evidencias:0, informes:0, sanciones:0, auditoría:0, corteZ:0, proveedor2:0, privacidad:0, transparencia:0, denuncia:0};

      rec.answers.forEach((a,i)=>{
        const q=rec.questions[i];
        const ok = (a!==null && q.opts[a].ok);
        if(ok) etico++;
        const topic = q.topic in areaCounts ? q.topic : 'informes';
        areaCounts[topic]++;
        if(!ok) areaRiesgo[topic]++;
      });
      const riesgo = total - etico;

      const bueno=[]; const malo=[]; const recomendado=[];
      if(etico/total>=0.9){bueno.push('Sólidos criterios éticos y apego a protocolo.');}
      else if(etico/total>=0.75){bueno.push('Buen criterio con áreas puntuales a reforzar.');}
      else {malo.push('Criterio ético insuficiente para rol de supervisión.'); recomendado.push('Repasar Código de Ética y protocolos de evidencias/denuncia.');}

      Object.keys(areaCounts).forEach(k=>{
        if(areaCounts[k]===0) return;
        const r=areaRiesgo[k];
        if(r/areaCounts[k]>=0.5){
          if(k==='caja'||k==='corteZ'||k==='depósitos'){ malo.push('Riesgo en control de efectivo.'); recomendado.push('Reforzar corte Z, retiros/depósitos y comprobación.'); }
          if(k==='proveedor'||k==='proveedor2'){ malo.push('Conflictos de interés y recepciones sin respaldo.'); recomendado.push('Capacitación en integridad con terceros.'); }
          if(k==='cíclicos'||k==='inventario'||k==='mermas'){ malo.push('Ajustes sin evidencia.'); recomendado.push('Exigir fotos, documentos y notas de recepción.'); }
          if(k==='tickets'){ malo.push('Tolerancia a fraude en tickets.'); recomendado.push('Proceso disciplinario y trazabilidad.'); }
          if(k==='datos'||k==='privacidad'){ malo.push('Uso indebido de datos/sistemas.'); recomendado.push('Autorizaciones formales y mínimo privilegio.'); }
          if(k==='seguridad'){ malo.push('Riesgo en manejo de seguridad.'); recomendado.push('Protocolos de emergencia y pausas operativas.'); }
          if(k==='informes'||k==='transparencia'){ malo.push('Manipulación de reportes.'); recomendado.push('Reporte factual con evidencia obligatoria.'); }
          if(k==='sanciones'||k==='denuncia'||k==='auditoría'||k==='evidencias'){ malo.push('Débil apego a procesos formales.'); recomendado.push('Checklist de auditoría/denuncia y cadena de custodia.'); }
        }
      });

      const area=document.getElementById('analysisArea'); area.innerHTML='';
      const summary=document.createElement('div');
      summary.className='analysis-summary';
      summary.innerHTML = `<h3>Resumen</h3>
        <p class='pill'>Ético: ${etico}/${total}</p>
        <p class='pill'>Riesgoso: ${riesgo}/${total}</p>
        <p><strong>Lo bueno:</strong> ${bueno.join(' ')||'—'}</p>
        <p><strong>Lo malo:</strong> ${malo.join(' ')||'—'}</p>
        <p><strong>Recomendado:</strong> ${recomendado.join(' • ')||'—'}</p>`;
      area.appendChild(summary);

      const canvas=document.createElement('canvas'); area.appendChild(canvas);
      new Chart(canvas,{
        type:'bar',
        data:{labels:['Ético','Riesgoso'],datasets:[{label:'Integridad',data:[etico,riesgo]}]},
        options:{responsive:true,scales:{y:{beginAtZero:true}}}
      });
    }
  }
  </script>
</body>
</html>
